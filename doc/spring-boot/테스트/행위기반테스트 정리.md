# 📘 Mockito 행위 기반 테스트 (Behavior Verification) 정리

---

## ✅ verify(...) 핵심 개념

- `verify(...)`는 테스트 대상 객체가 **어떤 외부 의존 객체의 메서드를 실제로 호출했는지 확인**할 수 있도록 해주는 Mockito의 핵심 메서드입니다.
- 행위 기반 테스트(Behavior-Driven Test)의 핵심은 **동작 자체가 발생했는지 여부**를 검증하는 것입니다.

```java
verify(mockObject).someMethod(args);
```

---

## ✅ verify(...) 주요 사용법

| 메서드 | 설명 |
|--------|------|
| `verify(mock).method(...)` | 메서드가 호출되었는지 확인 |
| `verify(mock, times(n)).method(...)` | n번 호출되었는지 확인 |
| `verify(mock, never()).method(...)` | 한 번도 호출되지 않았는지 확인 |
| `verifyNoInteractions(mock)` | mock 객체와 어떤 상호작용도 없었는지 확인 |
| `doNothing().when(mock).method(...)` | void 메서드를 Stubbing (예외 없이 동작) |

---

## ✅ 예제 코드 모음

### ✅ 1. 호출 여부 검증

```java
verify(emailService).sendEmail(anyString());
```

→ `sendEmail()` 메서드가 호출되었는지 확인

---

### ✅ 2. 호출 횟수 검증

```java
verify(emailService, times(1)).sendEmail("hello@test.com");
```

→ 정확히 1번 호출되었는지 확인

---

### ✅ 3. 호출되지 않았는지 확인

```java
verify(notificationService, never()).notify(anyString());
```

→ 한 번도 호출되지 않았는지 확인

---

### ✅ 4. void 메서드 테스트 (Stubbing)

```java
doNothing().when(emailService).sendEmail(anyString());

emailService.sendEmail("test@test.com");
```

→ 실제로는 아무 일도 발생하지 않음 (예외도 없음)

---

### ✅ 5. 인자 확인

```java
verify(notificationPort).notify(contains("admin"));
verify(notificationPort).notify(eq("admin@urock.kr"));
verify(notificationPort).notify(anyString());
```

→ 호출 인자 값도 검증 가능

---

## ✅ 실전 구성 패턴: given → when → then

```java
// given
when(userRepository.existsById("abc")).thenReturn(true);

// when
userService.register("abc");

// then
verify(notificationService).notify("abc 가입 완료");
```

---

## ✅ 실무 팁

| 상황 | 추천 사용 예 |
|------|---------------|
| 외부 시스템 호출 검증 | `verify(...)` |
| 이벤트 발행 검증 | `verify(publisher).publish(...)` |
| void 메서드 테스트 | `doNothing().when(...)` |
| 테스트 대상의 부작용 확인 | `verify(mock, never())` |

---

## ✅ 요약

- `verify(...)`는 외부 의존성과의 **상호작용이 예상대로 수행되었는지** 검증하는 도구
- 메서드 호출 여부, 횟수, 인자 값 등 다양한 방식으로 검증 가능
- 테스트를 통해 **비즈니스 로직이 어떤 외부 효과를 일으키는지 확인**할 수 있음